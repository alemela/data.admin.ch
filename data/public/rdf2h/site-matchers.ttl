@base <http://data.admin.ch/> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix r2h: <http://rdf2h.github.io/2015/rdf2h#> .
@prefix dc: <http://purl.org/dc/elements/1.1/>.
@prefix foaf: <http://xmlns.com/foaf/0.1/> .
@prefix zzm: <http://zz2h.zazukoinas.org/modes/> .
@prefix zz2h: <http://zz2h.zazukoinas.org/ontology/> .
@prefix schema: <http://schema.org/> .
@prefix site: <http://schema.zazuko.com/site/> .
@prefix r2hp: <http://rdf2h.github.io/2015/rdf2h-points/> .
@prefix dc: <http://dublincore.org/2012/06/14/dcelements#>.
@prefix gont: <https://gont.ch/> .
@prefix mode: <http://zazukoians.github.org/rdf2h/modes#> .


<capsdadmin> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''<div id="header"><img src="/img/admin-logo.png" height="70px" align="left" vspace="15" hspace="10"><p align="right"><h2 align="right">data.admin.ch</h2></p><p align="right">
Linked Data Pilot</p></div>
        {{{:continue}}}<div id="footer">
            Powered by <a href="https://github.com/zazukoians/trifid-ld" style="color:white">TRIFID-LD</a><br/>
            Code on <a href="https://github.com/zazuko/data.admin.ch" style="color:white"><b>github</b></a>
        </div>'''
  ];
  r2h:before <catchall>.

<webpage> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object schema:WebPage
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
    <head>
      <link rel="shortcut icon" href="http://data.admin.ch/favicon.ico" />

      <link href="graph_files/main.css" media="screen, print" type="text/css" rel="stylesheet" />
      <link href="graph_files/98da0a4.css" media="screen, print" type="text/css" rel="stylesheet" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.6/css/bootstrap.min.css" type="text/css" />
      <link rel="stylesheet" href="css/main.css" type="text/css" />
    </head>
    <body>
      <div class="row-fluid" id="top">
        <div class="span6 offset6" id="federal-authorities-bar">
          <a href="http://www.admin.ch/?lang=de" title="Bundesverwaltung admin.ch">Bundesverwaltung admin.ch</a>
        </div>
      </div>

      <div id="header" class="row-fluid">
        <div id="brand">
          <div id="ogd-portal-description">
            <h2><a href="/">data.admin.ch</a></h2>
            <h3><a href="/">Linked Data Pilot</a></h3>
          </div>
          <div id="logo">
            <a class="logo" href="http://data.admin.ch/"><img alt="Startseite data.admin.ch" title="Startseite data.admin.ch" src="graph_files/admin-logo.png" /></a>
          </div>
        </div>

        <div id="menu">
          {{{:render site:hasMenu}}}
        </div>
      </div>

      <div id="intro">{{{:render site:hasIntro}}}</div>

      <div role="main" id="main">
        <div class="flash-messages"></div>
        <div id="boxes">
          {{{:render site:hasBoxLeft}}}
          {{{:render site:hasBoxRight}}}

          {{{:render site:hasContainer}}}
        </div>
      </div>

      {{{:continue}}}
    </body>
    '''
  ];
  r2h:before <parts>.


<menu> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Menu
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <ul class="nav nav-pills menu-item">
        {{{schema:articleBody}}}
      </ul>
    '''
  ];
  r2h:before <catchall>.


<intro> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Intro
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <div id="tagline_header">
        <div id="tagline" class="row-fluid">
          <div class="tagtext-left">
            <h1>{{{site:title}}}</h1>
            <p style="font-size: 1.2em;">{{{schema:articleBody}}}</p>
          </div>
          <div class="tagtext-right">
            <h2>{{{site:sideTitle}}}</h2>
            {{{site:sideBody}}}
          </div>
        </div>
      </div>
    '''
  ];
  r2h:before <catchall>.


<content> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:DefaultContent
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <hr class="style-shadow"/>
      <div class="content">
	<h1>{{{site:title}}}</h1>
	<hr style="margin-top: 0px;"/>
	<p>{{{schema:articleBody}}}</p>
      </div>
    '''
  ];
  r2h:before <catchall>.


<box> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Box
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <div class="panel panel-primary box-moving box-container">
        <div class="panel-heading"><h4>{{{site:title}}}</h4></div>
        <div class="panel-body">
          {{{schema:articleBody}}}
        </div>
      </div>
    '''
  ];
  r2h:before <catchall>.


<container> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Container
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <div class="row-fluid participate spacing"></div>

      <div class="panel panel-primary box-container box-wrapper">
        <div class="panel-heading"><h4>{{{site:title}}}</h4></div>
        <div class="panel-body">
          {{{:render site:hasApplicationLeft}}}
          {{{:render site:hasApplicationRight}}}
        </div>
      </div>
    '''
  ];
  r2h:before <catchall>.


<application> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Application
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <div class="panel panel-info box-moving box-container">
        <div class="panel-heading"><b>{{{site:title}}}</b></div>
        <div class="panel-body">
          {{{schema:articleBody}}}
        </div>
      </div>
    '''
  ];
  r2h:before <catchall>.

<footer> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate rdf:type;
    r2h:object site:Footer
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:mustache '''
      <footer class="footer">
        {{{schema:articleBody}}}
      </footer>
    '''
  ];
  r2h:before <catchall>.

<parts> a r2h:Matcher ;
  r2h:triplePattern [
    r2h:subject r2h:this;
    r2h:predicate schema:hasPart
  ];
  r2h:template [
    r2h:context r2h:Default;
    r2h:javaScript '''function(n) {
            var result = "";
            var parts = n.graphNode.out(RDF2h.resolveCurie("schema:hasPart")).toArray();
            parts.sort(function(a,b) {
               var dc = RDF2h.resolveCurie("schema:dateCreated");
               return - a.out(dc).toString().localeCompare(b.out(dc).toString());
            });
            parts.forEach(function(p) {
                result += n.rdf2h.render(n.graph, p.nodes()[0], n.context);
            });
            return result;
        }'''
  ];
  r2h:before <catchall>.


<versions> a r2h:Matcher ;
    r2h:triplePattern [        
        r2h:subject r2h:this;
        r2h:predicate gont:municipalityVersion;
    ];
    r2h:template [ 
        r2h:context r2h:Default;
        r2h:mustache '''
        {{{:continue}}}

        <div id="history" class="panel-group">
          <div class="panel panel-default">
            <div class="panel-heading">
              <h4 class="panel-title">History</h4>
            </div>
            <div id="collapseHistory" class="panel-collapse">
              <div class="panel-body">
                <div style="text-align:center;">
                  <h4>Navigate all the versions for this municipality</h4>
                  <ul class="pagination" id="version-navigation"></ul>
                </div>
                <div id="allVersions">
                  {{#gont:municipalityVersion}}
                  <div class="mVersion" style="display:none">
                    <span resource="{{.}}" context="mode:details" 
                    class="fetch">Municipality should appear here</span>
                  </div>
                  {{/gont:municipalityVersion}}
                </div>
              </div>
            </div>
          </div>
        </div>
        <script>
          function showDiv(n) {
            $('.mVersion').each(function(i, obj) {
              if (i===n) {
                $(".mVersion").hide();
                $(this).show();
              }
            });
            $('.versionPages').each(function(i, obj) {
              if (i===n) {
                $(".versionPages").removeClass('active');
                $(this).addClass('active');
              }
            });
          }
          $( document ).ready(function() {
            $('.mVersion').each(function(i, obj) {
              var v = i+1;
              $("#version-navigation").append('<li class="versionPages"><a href="#" onClick="showDiv('+i+'); return false;">'+v+'</a></li>');
            });
            $("#history").insertAfter( $( ".container" ) );
            $("#history").show();
            $(".mVersion").first().show();
            $(".versionPages").first().addClass('active');
          });
        </script>
'''
    ];
    r2h:before <startEscapeStandardCaps>.

<startEscapeStandardCaps> a r2h:Matcher ;
    r2h:triplePattern [        
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
    ];
    r2h:template [ 
        r2h:context r2h:Default;
        r2h:mustache '''
        {{{:continue mode:loopholeTrifidCaps}}}
        '''
    ];
    r2h:before <caps>.

<http://zazukoians.org/2016/generic-rdf2h-matchers/caps> r2h:before <endEscapeStandardCaps>.

<endEscapeStandardCaps> a r2h:Matcher ;
    r2h:triplePattern [        
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
    ];
    r2h:template [ 
        r2h:context mode:loopholeTrifidCaps;
        r2h:mustache '''
        {{{:continue r2h:Default}}}
        '''
    ];
    r2h:before <catchall>.

[ a r2h:Matcher ;
    r2h:triplePattern [      
        r2h:subject r2h:this;
        r2h:predicate gont:abolitionEvent
    ];
    r2h:template [ 
        r2h:context mode:title;
        r2h:mustache '''<!-- abolished version not shown -->'''
    ]
] r2h:before

[ a r2h:Matcher ;
    r2h:triplePattern [      
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object gont:MunicipalityVersion
    ];
    r2h:template [ 
        r2h:context mode:title;
        r2h:mustache '''<h1>{{gont:longName}}</h1>'''
    ];
    r2h:template [ 
        r2h:context mode:details;
        r2h:mustache '''<h3>Details for: {{gont:longName}}</h3>
        Admission date: <span resource="{{gont:admissionEvent}}" context="mode:date-only" 
            class="fetch">admission date should appear here</span><br/>
        {{{:continue mode:loopholeCaps}}}
'''
    ];
    r2h:before r2hp:specific;
    r2h:before <page>;
    r2h:before <headline>;
    r2h:before <endEscapeDadminCaps>;
].

<capsdadmin> r2h:before <endEscapeDadminCaps>.
<http://zazukoians.org/2016/generic-rdf2h-matchers/main> r2h:before <endEscapeDadminCaps>.

<endEscapeDadminCaps> a r2h:Matcher ;
    r2h:triplePattern [        
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
    ];
    r2h:template [ 
        r2h:context mode:loopholeCaps;
        r2h:mustache '''
        {{{:continue r2h:Default}}}
        '''
    ];
    r2h:before <catchall>.

[ a r2h:Matcher ;
    r2h:triplePattern [      
        r2h:subject r2h:this;
        r2h:predicate rdf:type;
        r2h:object gont:MunicipalityChangeEvent
    ];
    r2h:template [ 
        r2h:context mode:date-only;
        r2h:mustache '''{{gont:date}}'''
    ];
    r2h:before r2hp:specific;
    r2h:before <page>;
    r2h:before <headline>;
].


